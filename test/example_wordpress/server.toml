max_order = 6

# Remove old public stuff
[[remove]]
source = ".run/public/*"
ignore = ".run/public/.gitignore"
cmd = "init"
order = 1

# Download wordpress
[[raw]]
command = "git"
args = ["clone", "-b '4.5' --single-branch --depth 1", "https://github.com/WordPress/WordPress.git", ".run/public/wordpress"]
cmd = "init"
order = 2

# Set config file
[[copy]]
source = ".run/config/wp-config.dev.php"
destination = ".run/public/wordpress/wp-config.php"
cmd = "init"
order = 3

# Remove old folders for linkage
[[remove]]
source = ".run/public/wordpress/wp-content"
cmd = "init"
order = 3

# Set linkage for the themes / uploads / plugins
[[raw]]
command = "ln"
args = ["-s", "$(pwd)/src", ".run/public/wordpress/wp-content"]
cmd = "init"
order = 4

[server]

[[server.container]]
name = "examplewp-mysql"
type = "mysql:5.6"
port = "3306:3306"
env_var = [
    "MYSQL_ROOT_PASSWORD=p3QxMMBmYrn43pHU",
    "MYSQL_DATABASE=examplewp",
    "MYSQL_USER=examplewp",
    "MYSQL_PASSWORD=p3QxMMBmYrn43pHU",
    "STARTUP_SQL=/docker-entrypoint-initdb.d/initial.sql"
]
volume = ["./db/initial.sql:/docker-entrypoint-initdb.d/initial.sql"]
sleep = 30
order = 4

[[server.container]]
name = "examplewp-nginx"
type = "richarvey/nginx-php-fpm:latest"
port = "8000:80"
link = ["examplewp-mysql:mysql"]
env_var = [
    "ERRORS=1",
    "NGINX_PORT=80"
]
volume = [
    "./.run/nginx.conf:/etc/nginx/conf.d/default.conf:ro",
    "./.run/nginx.conf:/etc/nginx/sites-enabled/default.conf:ro",
    "./.run/nginx.conf:/etc/nginx/sites-available/default.conf:ro",
    "./.run/public:/var/www/examplewp/www:ro",
    "./log/nginx:/var/log/nginx"
]
sleep = 5
order = 5
